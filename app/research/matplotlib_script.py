import numpy as np
import cv2
import pickle
import matplotlib.pyplot as plt

# --------------------------------------------CONSTANTS--------------------------------------------
# FILE_TYPES
FILE_TYPE_CSV = 'csv'
FILE_TYPE_PKL = 'pkl'

# COMPARISON_PARAMETERS
ITERATIONS_NUMBER = 100
MAX_CENTER_DISPLACEMENT = 0.5
MIN_CENTER_DISPLACEMENT = 0.0
MAX_AREA_DIFFERENCE = 0.5
MIN_AREA_DIFFERENCE = 0.0

# --------------------------------------------INPUT--------------------------------------------

# INPUT_DATA
image_number = 1
file_type = FILE_TYPE_CSV

# COMARISON_CRITERIA
cnts_center_displacement = 0.3
cnts_area_difference_factor = 0.3

if image_number == 1:
    FILE_NAME_IMAGE_INITIAL = 'img1.jpg'
    FILE_NAME_IMAGE_GROUND_TRUTH = 'cells1.jpg'
    FILE_NAME_FILE_CSV = 'csv1.txt'
    FILE_NAME_FILE_PKL = ''
elif image_number == 2:
    FILE_NAME_IMAGE_INITIAL = 'img2_2016-03-01 21.42.11.jpg'
    FILE_NAME_IMAGE_GROUND_TRUTH = 'cells2_2016-03-01 21.42.11.jpg'
    FILE_NAME_FILE_CSV = 'csv2.txt'
    FILE_NAME_FILE_PKL = 'cells1.pkl'
elif image_number == 3:
    FILE_NAME_IMAGE_INITIAL = 'img3_20160630_160547.jpg'
    FILE_NAME_IMAGE_GROUND_TRUTH = 'cells3_20160630_160547.jpg'
    FILE_NAME_FILE_CSV = 'csv3.txt'
    FILE_NAME_FILE_PKL = 'cells2_2016-03-01_21.42.11.pkl'
elif image_number == 4:
    FILE_NAME_IMAGE_INITIAL = 'img4_20160630_160548.jpg'
    FILE_NAME_IMAGE_GROUND_TRUTH = 'cells4_20160630_160548.jpg'
    FILE_NAME_FILE_CSV = 'csv4.txt'
    FILE_NAME_FILE_PKL = 'cells4_20160630_160548.pkl'
else:
    print('INCORRECT NUMBER!')

PATH_TO_FOLDER_IMAGE_INITIAL = '../resources/images_initial/'
PATH_TO_FOLDER_IMAGE_GROUND_TRUTH = '../resources/images_photoshop/'
PATH_TO_FOLDER_FILE_CSV = '../resources/csv/'
PATH_TO_FOLDER_FILE_PKL = 'r../resources/pkl/'

PATH_TO_IMAGE_INITIAL = PATH_TO_FOLDER_IMAGE_INITIAL + FILE_NAME_IMAGE_INITIAL
PATH_TO_IMAGE_GROUND_TRUTH = PATH_TO_FOLDER_IMAGE_GROUND_TRUTH + FILE_NAME_IMAGE_GROUND_TRUTH
PATH_TO_FILE_CSV = PATH_TO_FOLDER_FILE_CSV + FILE_NAME_FILE_CSV
PATH_TO_FILE_PKL = PATH_TO_FOLDER_FILE_PKL + FILE_NAME_FILE_PKL

# --------------------------------------------OUTPUT--------------------------------------------
PATH_TO_FOLDER_OUTPUT = '../output/'
PATH_TO_FOLDER_OUTPUT_MATPLOTLIB_PLOTS = '../output/matplotlib_plots'

PATH_TO_FOLDER_OUTPUT_GT_CONTOURS = '../output/GT_contours/'
PATH_TO_FOLDER_OUTPUT_GT_ELLIPSES = '../output/GT_ellipses/'
PATH_TO_FOLDER_OUTPUT_METHOD_CONTOURS = '../output/method_cnts/'
PATH_TO_FOLDER_OUTPUT_VALIDATION = '../output/validation/'

PATH_TO_FILE_OUTPUT_GT_CONTOURS = PATH_TO_FOLDER_OUTPUT_GT_CONTOURS + 'GT_contours_' + FILE_NAME_IMAGE_INITIAL
PATH_TO_FILE_OUTPUT_GT_ELLIPSES = PATH_TO_FOLDER_OUTPUT_GT_ELLIPSES + 'GT_ellipses_' + FILE_NAME_IMAGE_INITIAL
PATH_TO_FILE_OUTPUT_METHOD_CONTOURS = PATH_TO_FOLDER_OUTPUT_METHOD_CONTOURS + 'method_cnts_' + FILE_NAME_IMAGE_INITIAL
PATH_TO_FILE_OUTPUT_VALIDATION = PATH_TO_FOLDER_OUTPUT_VALIDATION + 'validation_' + FILE_NAME_IMAGE_INITIAL



cnts_center_displacement_list = [0.0, 0.005, 0.01, 0.015, 0.02, 0.025, 0.03, 0.035, 0.04, 0.045, 0.05, 0.055, 0.06,
                                 0.065, 0.07, 0.075, 0.08, 0.085, 0.09, 0.095, 0.1, 0.105, 0.11, 0.115, 0.12, 0.125,
                                 0.13, 0.135, 0.14, 0.145, 0.15, 0.155, 0.16, 0.165, 0.17, 0.17500000000000002, 0.18,
                                 0.185, 0.19, 0.195, 0.2, 0.20500000000000002, 0.21, 0.215, 0.22, 0.225, 0.23,
                                 0.23500000000000001, 0.24, 0.245, 0.25, 0.255, 0.26, 0.265, 0.27, 0.275, 0.28,
                                 0.28500000000000003, 0.29, 0.295, 0.3, 0.305, 0.31, 0.315, 0.32, 0.325, 0.33, 0.335,
                                 0.34, 0.34500000000000003, 0.35000000000000003, 0.355, 0.36, 0.365, 0.37, 0.375, 0.38,
                                 0.385, 0.39, 0.395, 0.4, 0.405, 0.41000000000000003, 0.41500000000000004, 0.42, 0.425,
                                 0.43, 0.435, 0.44, 0.445, 0.45, 0.455, 0.46, 0.465, 0.47000000000000003,
                                 0.47500000000000003, 0.48, 0.485, 0.49, 0.495]
cnts_area_difference_factor_list = [0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,
                                    0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,
                                    0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,
                                    0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,
                                    0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3,
                                    0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3]
common_cnt_number_list = [0, 4, 4, 4, 7, 9, 10, 10, 14, 15, 20, 26, 29, 35, 39, 43, 47, 48, 52, 56, 58, 62, 64, 67, 75,
                          77, 83, 88, 89, 91, 92, 94, 97, 99, 100, 101, 102, 102, 104, 104, 105, 106, 106, 107, 109,
                          109, 109, 109, 109, 109, 110, 110, 112, 112, 112, 112, 112, 113, 113, 114, 114, 114, 114, 115,
                          116, 118, 119, 120, 120, 121, 122, 122, 122, 122, 123, 123, 123, 123, 124, 125, 125, 125, 125,
                          125, 126, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 127, 128, 129]
fail_GT_cnt_number_list = [619, 615, 615, 615, 612, 610, 609, 609, 605, 604, 599, 593, 590, 584, 580, 576, 572, 571,
                           567, 563, 561, 557, 555, 552, 544, 542, 536, 531, 530, 528, 527, 525, 522, 520, 519, 518,
                           517, 517, 515, 515, 514, 513, 513, 512, 510, 510, 510, 510, 510, 510, 509, 509, 507, 507,
                           507, 507, 507, 506, 506, 505, 505, 505, 505, 504, 503, 501, 500, 499, 499, 498, 497, 497,
                           497, 497, 496, 496, 496, 496, 495, 494, 494, 494, 494, 494, 493, 492, 492, 492, 492, 492,
                           492, 492, 492, 492, 492, 492, 492, 492, 491, 490]
fail_method_cnt_number_list = [369, 365, 365, 365, 362, 360, 359, 359, 355, 354, 349, 343, 340, 334, 330, 326, 322, 321,
                               317, 313, 311, 307, 305, 302, 294, 292, 286, 281, 280, 278, 277, 275, 272, 270, 269, 268,
                               267, 267, 265, 265, 264, 263, 263, 262, 260, 260, 260, 260, 260, 260, 259, 259, 257, 257,
                               257, 257, 257, 256, 256, 255, 255, 255, 255, 254, 253, 251, 250, 249, 249, 248, 247, 247,
                               247, 247, 246, 246, 246, 246, 245, 244, 244, 244, 244, 244, 243, 242, 242, 242, 242, 242,
                               242, 242, 242, 242, 242, 242, 242, 242, 241, 240]
accuracy_cnt_number_list = [0.0, 0.006462035541195477, 0.006462035541195477, 0.006462035541195477, 0.011308562197092083,
                            0.014539579967689823, 0.01615508885298869, 0.01615508885298869, 0.022617124394184167,
                            0.024232633279483037, 0.03231017770597738, 0.0420032310177706, 0.046849757673667204,
                            0.05654281098546042, 0.0630048465266559, 0.06946688206785137, 0.07592891760904685,
                            0.07754442649434572, 0.0840064620355412, 0.09046849757673667, 0.09369951534733441,
                            0.10016155088852989, 0.10339256865912763, 0.10823909531502424, 0.12116316639741519,
                            0.12439418416801293, 0.13408723747980614, 0.1421647819063005, 0.14378029079159935,
                            0.1470113085621971, 0.14862681744749595, 0.1518578352180937, 0.1567043618739903,
                            0.15993537964458804, 0.16155088852988692, 0.1631663974151858, 0.16478190630048464,
                            0.16478190630048464, 0.1680129240710824, 0.1680129240710824, 0.16962843295638125,
                            0.17124394184168013, 0.17124394184168013, 0.172859450726979, 0.17609046849757673,
                            0.17609046849757673, 0.17609046849757673, 0.17609046849757673, 0.17609046849757673,
                            0.17609046849757673, 0.1777059773828756, 0.1777059773828756, 0.18093699515347333,
                            0.18093699515347333, 0.18093699515347333, 0.18093699515347333, 0.18093699515347333,
                            0.1825525040387722, 0.1825525040387722, 0.1841680129240711, 0.1841680129240711,
                            0.1841680129240711, 0.1841680129240711, 0.18578352180936994, 0.18739903069466882,
                            0.19063004846526657, 0.19224555735056542, 0.1938610662358643, 0.1938610662358643,
                            0.19547657512116318, 0.19709208400646203, 0.19709208400646203, 0.19709208400646203,
                            0.19709208400646203, 0.1987075928917609, 0.1987075928917609, 0.1987075928917609,
                            0.1987075928917609, 0.20032310177705978, 0.20193861066235863, 0.20193861066235863,
                            0.20193861066235863, 0.20193861066235863, 0.20193861066235863, 0.2035541195476575,
                            0.20516962843295639, 0.20516962843295639, 0.20516962843295639, 0.20516962843295639,
                            0.20516962843295639, 0.20516962843295639, 0.20516962843295639, 0.20516962843295639,
                            0.20516962843295639, 0.20516962843295639, 0.20516962843295639, 0.20516962843295639,
                            0.20516962843295639, 0.20678513731825526, 0.2084006462035541]
common_cnt_area_list = [0, 4902.0, 4902.0, 4902.0, 14589.5, 18828.5, 20394.5, 20394.5, 31651.0, 32154.0, 46121.5,
                        59234.0, 62738.5, 75037.0, 83171.0, 91057.5, 98079.0, 98686.5, 102011.5, 105770.5, 107622.5,
                        112282.5, 112971.0, 116963.0, 122314.5, 123635.0, 127746.5, 130749.5, 131220.5, 132105.5,
                        132508.5, 133275.5, 135756.5, 136716.5, 137035.5, 138240.0, 139391.5, 139391.5, 140893.0,
                        140893.0, 141125.0, 141525.0, 141525.0, 142590.0, 143301.5, 143301.5, 143301.5, 143301.5,
                        143301.5, 143301.5, 145295.5, 145295.5, 147191.5, 147191.5, 147191.5, 147191.5, 147191.5,
                        147501.5, 147501.5, 147797.5, 147797.5, 147797.5, 147797.5, 148458.5, 148708.5, 149400.5,
                        149632.5, 149961.5, 149961.5, 150270.5, 150801.0, 150801.0, 150801.0, 150801.0, 151068.0,
                        151068.0, 151068.0, 151068.0, 151877.5, 152291.0, 152291.0, 152291.0, 152291.0, 152291.0,
                        152572.5, 152774.5, 152774.5, 152774.5, 152774.5, 152774.5, 152774.5, 152774.5, 152774.5,
                        152774.5, 152774.5, 152774.5, 152774.5, 152774.5, 153041.5, 153374.5]
fail_GT_cnt_area_list = [303271.0, 298369.0, 298369.0, 298369.0, 288681.5, 284442.5, 282876.5, 282876.5, 271620.0,
                         271117.0, 257149.5, 244037.0, 240532.5, 228234.0, 220100.0, 212213.5, 205192.0, 204584.5,
                         201259.5, 197500.5, 195648.5, 190988.5, 190300.0, 186308.0, 180956.5, 179636.0, 175524.5,
                         172521.5, 172050.5, 171165.5, 170762.5, 169995.5, 167514.5, 166554.5, 166235.5, 165031.0,
                         163879.5, 163879.5, 162378.0, 162378.0, 162146.0, 161746.0, 161746.0, 160681.0, 159969.5,
                         159969.5, 159969.5, 159969.5, 159969.5, 159969.5, 157975.5, 157975.5, 156079.5, 156079.5,
                         156079.5, 156079.5, 156079.5, 155769.5, 155769.5, 155473.5, 155473.5, 155473.5, 155473.5,
                         154812.5, 154562.5, 153870.5, 153638.5, 153309.5, 153309.5, 153000.5, 152470.0, 152470.0,
                         152470.0, 152470.0, 152203.0, 152203.0, 152203.0, 152203.0, 151393.5, 150980.0, 150980.0,
                         150980.0, 150980.0, 150980.0, 150698.5, 150496.5, 150496.5, 150496.5, 150496.5, 150496.5,
                         150496.5, 150496.5, 150496.5, 150496.5, 150496.5, 150496.5, 150496.5, 150496.5, 150229.5,
                         149896.5]
fail_method_cnt_area_list = [252343.0, 247598.5, 247598.5, 247598.5, 238680.5, 234847.5, 233283.5, 233283.5, 222131.5,
                             221736.0, 208827.0, 196256.5, 192906.5, 180883.5, 172876.5, 166001.5, 159670.5, 158884.5,
                             155557.5, 151877.5, 150126.0, 145017.5, 144276.5, 140183.0, 134748.0, 133716.5, 129780.0,
                             127149.5, 126676.5, 125821.5, 125390.0, 124525.5, 121834.5, 121004.5, 120614.5, 119697.5,
                             118880.5, 118880.5, 117503.0, 117503.0, 117265.0, 116746.0, 116746.0, 115887.0, 115196.5,
                             115196.5, 115196.5, 115196.5, 115196.5, 115196.5, 113652.5, 113652.5, 111572.5, 111572.5,
                             111572.5, 111572.5, 111572.5, 111290.0, 111290.0, 110933.0, 110933.0, 110933.0, 110933.0,
                             110238.0, 110050.5, 109411.0, 109243.5, 108980.0, 108980.0, 108663.0, 108119.0, 108119.0,
                             108119.0, 108119.0, 107815.0, 107815.0, 107815.0, 107815.0, 107070.0, 106537.5, 106537.5,
                             106537.5, 106537.5, 106537.5, 106334.0, 106077.0, 106077.0, 106077.0, 106077.0, 106077.0,
                             106077.0, 106077.0, 106077.0, 106077.0, 106077.0, 106077.0, 106077.0, 106077.0, 105874.0,
                             105615.0]
accuracy_cnt_area_list = [0.0, 0.016163761124538777, 0.016163761124538777, 0.016163761124538777, 0.04810713849988954,
                          0.06208473609412044, 0.0672484345684223, 0.0672484345684223, 0.104365402560746,
                          0.10602398514859647, 0.15208015273468284, 0.19531705965951246, 0.20687273098977482,
                          0.24742556986985237, 0.27424646603203073, 0.3002512604238453, 0.3234038203454996,
                          0.32540697923639256, 0.3363707706968355, 0.34876562546369416, 0.3548723748726387,
                          0.3702381698217106, 0.37250841656472267, 0.38567156107903494, 0.40331749491379,
                          0.40767168637950874, 0.4212288679102189, 0.43113090272396637, 0.43268396912332535,
                          0.43560215121129287, 0.43693099571010746, 0.43946008685301263, 0.4476408888419928,
                          0.4508063744967372, 0.4518582390007617, 0.45582993428319885, 0.459626868378447,
                          0.459626868378447, 0.4645778857853207, 0.4645778857853207, 0.46534287815188397,
                          0.46666183050802745, 0.46666183050802745, 0.4701735411562596, 0.47251962765974986,
                          0.47251962765974986, 0.47251962765974986, 0.47251962765974986, 0.47251962765974986,
                          0.47251962765974986, 0.4790946051551253, 0.4790946051551253, 0.48534643932324556,
                          0.48534643932324556, 0.48534643932324556, 0.48534643932324556, 0.48534643932324556,
                          0.4863686273992568, 0.4863686273992568, 0.487344652142803, 0.487344652142803,
                          0.487344652142803, 0.487344652142803, 0.48952422091133013, 0.4903485661339198,
                          0.4926303537100481, 0.49339534607661134, 0.4944801843895394, 0.4944801843895394,
                          0.49549907508466023, 0.4972483356469956, 0.4972483356469956, 0.4972483356469956,
                          0.4972483356469956, 0.4981287363447214, 0.4981287363447214, 0.4981287363447214,
                          0.4981287363447214, 0.5007979661754668, 0.5021614331736302, 0.5021614331736302,
                          0.5021614331736302, 0.5021614331736302, 0.5021614331736302, 0.5030896458942662,
                          0.5037557168341187, 0.5037557168341187, 0.5037557168341187, 0.5037557168341187,
                          0.5037557168341187, 0.5037557168341187, 0.5037557168341187, 0.5037557168341187,
                          0.5037557168341187, 0.5037557168341187, 0.5037557168341187, 0.5037557168341187,
                          0.5037557168341187, 0.5046361175318445, 0.5057341453683339]

plt.subplot(121)
common_cnt_plot, = plt.plot(cnts_center_displacement_list, common_cnt_number_list)
plt.xlabel('displacement of centers factor')
plt.ylabel('Number of common contours')
# plt.show()

fail_GT_cnt_plot, = plt.plot(cnts_center_displacement_list, fail_GT_cnt_number_list)
plt.xlabel('displacement of centers factor')
plt.ylabel('Number of fail GT contours')
# plt.show()

fail_method_cnt_plot, = plt.plot(cnts_center_displacement_list, fail_method_cnt_number_list)
plt.xlabel('displacement of centers factor')
plt.ylabel('Number of fail method contours')
# plt.show()
plt.legend((common_cnt_plot, fail_GT_cnt_plot, fail_method_cnt_plot), ('common', 'fail GT', 'fail method'))

plt.subplot(122)
plt.plot(cnts_center_displacement_list, accuracy_cnt_number_list)
plt.xlabel('displacement of centers factor')
plt.ylabel('Accuracy of method by cnt number')

PATH_TO_SAVE_PLOT = PATH_TO_FOLDER_OUTPUT_MATPLOTLIB_PLOTS+'_CNT_NUMBER_'+'_' +FILE_NAME_IMAGE_INITIAL[:-4]+file_type + '.png'
plt.savefig(PATH_TO_SAVE_PLOT)
plt.show()

plt.subplot(121)
common_cnt_area_plot, =plt.plot(cnts_center_displacement_list, common_cnt_area_list)
plt.xlabel('displacement of centers factor')
plt.ylabel('Area of common contours')
# plt.show()

fail_GT_cnt_area_plot, = plt.plot(cnts_center_displacement_list, fail_GT_cnt_area_list)
plt.xlabel('displacement of centers factor')
plt.ylabel('Area of fail GT contours')
# plt.show()

fail_method_cnt_area_plot, = plt.plot(cnts_center_displacement_list, fail_method_cnt_area_list)
plt.xlabel('displacement of centers factor')
plt.ylabel('Area of fail method contours')
# plt.show()
plt.legend((common_cnt_area_plot, fail_GT_cnt_area_plot, fail_method_cnt_area_plot), ('common', 'fail GT', 'fail method'))

plt.subplot(122)
plt.plot(cnts_center_displacement_list, accuracy_cnt_area_list)
plt.xlabel('displacement of centers factor')
plt.ylabel('Accuracy of method by cnt area')

PATH_TO_SAVE_PLOT = PATH_TO_FOLDER_OUTPUT_MATPLOTLIB_PLOTS+'_CNT_AREA_'+'_' +FILE_NAME_IMAGE_INITIAL[:-4]+file_type + '.png'
plt.savefig(PATH_TO_SAVE_PLOT)
plt.show()
